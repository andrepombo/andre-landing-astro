---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');

  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project }
  }));
}

const { project } = Astro.props as {
  project: import('astro:content').CollectionEntry<'projects'>;
};

const { Content } = await project.render();
const data = project.data;
const lang = 'en';
const toggleUrl = `/pt/projects/${project.slug}`;
---
<Base title={data.title} description={data.description} lang={lang}>
  <style is:global>
    [data-lang="pt"] { display: none; }
    [data-lang="en"] { display: block; }
  </style>
  <header class="sticky top-0 z-40 border-b border-slate-200/10 dark:border-slate-800/80 bg-white/70 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:bg-slate-950/70">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
      <a href="/" class="inline-flex items-center text-sm text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4 mr-1.5" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <polyline points="15 18 9 12 15 6" />
        </svg>
        Back to projects
      </a>
      <a
        href={toggleUrl}
        aria-label="Switch to Portuguese"
        class="px-3 py-1.5 rounded-full text-xs bg-slate-900 text-white border border-slate-800/80 dark:bg-slate-800 dark:text-slate-50 dark:border-slate-700 inline-flex items-center gap-1.5"
      >
        <span>PT</span><span>ðŸ‡§ðŸ‡·</span>
      </a>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 sm:px-6 py-12 sm:py-16">
    <article class={"space-y-6 " + (data.grayscale ? 'grayscale' : '')}>
      <header class="space-y-3">
        <p class="text-xs uppercase tracking-[0.2em] text-slate-500 dark:text-slate-400">Project</p>
        <h1 class="text-3xl sm:text-4xl font-bold tracking-tight">{data.title}</h1>
        <p class="text-base text-slate-600 dark:text-slate-300">{data.description}</p>

        {(data.tags?.length || data.href) && (
          <div class="flex items-center gap-2 pt-1">
            <div class="flex flex-wrap gap-2">
              {(data.tags ?? []).map((tag) => (
                <span class="text-xs px-2.5 py-1 rounded-full bg-slate-200 text-slate-800 border border-slate-300 dark:bg-slate-700 dark:text-slate-100 dark:border-slate-600">
                  {tag}
                </span>
              ))}
            </div>
            {data.href && (
              <a
                href={data.href}
                target="_blank"
                rel="noopener noreferrer"
                class="ml-auto inline-flex items-center gap-2 px-4 py-2 rounded-full bg-slate-900 text-slate-50 hover:bg-slate-800 dark:bg-slate-50 dark:text-slate-900 dark:hover:bg-slate-200 text-sm font-medium transition shrink-0"
              >
                <span>View live project</span>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M18 13v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                  <polyline points="15 3 21 3 21 9" />
                  <line x1="10" y1="14" x2="21" y2="3" />
                </svg>
              </a>
            )}
          </div>
        )}
      </header>

      {data.image && (
        <div class="mt-4 rounded-xl overflow-hidden border border-slate-200 dark:border-slate-800 bg-slate-100 dark:bg-slate-900">
          <img
            src={data.image}
            alt={data.title}
            class="w-full h-auto object-cover"
            loading="lazy"
            decoding="async"
          />
        </div>
      )}

      <section class="prose prose-slate dark:prose-invert max-w-none mt-6">
        <Content />
      </section>

      {data.href && (
        <div class="mt-6 flex justify-center">
          <a
            href={data.href}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-slate-900 text-slate-50 hover:bg-slate-800 dark:bg-slate-50 dark:text-slate-900 dark:hover:bg-slate-200 text-sm font-medium transition"
          >
            <span>View live project</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M18 13v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
              <polyline points="15 3 21 3 21 9" />
              <line x1="10" y1="14" x2="21" y2="3" />
            </svg>
          </a>
        </div>
      )}
    </article>
  </main>
</Base>
