---
grayscale: false
description_pt: Ferramenta completa de planejamento de rotas para caminhoneiros
  nos EUA que calcula a sequÃªncia ideal de paradas para abastecimento ao longo
  de qualquer viagem, minimizando o custo total de combustÃ­vel com base em
  preÃ§os reais de diesel, autonomia do caminhÃ£o e consumo (MPG) â€” com backend
  Django REST e frontend React/TypeScript com mapa interativo Leaflet.
title_pt: Planejador de Rotas para CaminhÃµes
slug: app3
title: Truck Route Planner
description: Full-stack route planning tool for US truck drivers that calculates
  the optimal fuel stop sequence along any interstate trip, minimizing total
  fuel cost based on real diesel prices, truck range, and MPG â€” built with a
  Django REST API and a React/TypeScript frontend with an interactive Leaflet
  map.
image: /uploads/truck-route-optimization-software.webp
href: https://app3.andrepombo.info/
tags:
  - Django
  - React
  - TypeScript
  - Leaflet
  - Docker
---

<div data-lang="en">

## Overview

A full-stack route planning tool built for US truck drivers. Given a start and finish city, the system geocodes both locations, fetches the driving route via the Geoapify Routing API, and then runs a fuel-stop optimizer that selects the cheapest diesel stations along the corridor â€” respecting the truck's maximum range and MPG â€” to minimize the total trip fuel cost.

The React/TypeScript frontend renders an interactive Leaflet map that progressively updates: the base Aâ†’B route appears first, then the detour polyline through the chosen fuel stops loads in the background without blocking the UI.

---

## Key Features

- **Optimal Fuel Stop Planning**  
  Greedy planner that selects the cheapest reachable diesel stations along the route corridor (within ~5 miles of the polyline), always ensuring the truck can reach the next stop or destination without running dry.

- **Real Diesel Price Data**  
  Fuel prices are loaded from a real-world CSV dataset of US diesel stations, imported into a PostgreSQL/SQLite database with spatial indexes for fast bounding-box queries.

- **Configurable Truck Parameters**  
  Supports custom MPG and maximum tank range (miles). The "start with empty tank" option triggers a pre-trip stop near the origin before hitting the highway.

- **Interactive Map (Leaflet)**  
  Displays the base route, the detour polyline through fuel stops, and custom markers for origin, destination, and each fuel station (with popup details: name, address, price, gallons purchased, cost).

- **City Autocomplete**  
  Debounced autocomplete input powered by the Geoapify Places API for fast city/state lookup.

- **Progressive Loading**  
  The base route and stop list render immediately after the first API response; the detour polyline through all stops is fetched asynchronously and updates the map without re-rendering the whole UI.

- **Trip Summary Panel**  
  Sidebar shows total distance (including detours), estimated duration, number of stops, and total estimated fuel cost.

- **Detour Calculation**  
  Backend computes the extra miles added by each station detour using polyline projection, and aggregates total detour miles in the trip summary.

- **Health Check Endpoint**  
  `/api/health/` verifies the fuel price dataset is loaded and returns the station count, used by the frontend to confirm API connectivity.

- **Docker Support**  
  Both services ship with Dockerfiles and a `docker-compose.yml` for one-command local setup.

---

## Tech Stack

- **Frontend**: React 18, TypeScript, Vite, React-Leaflet, TailwindCSS  
- **Backend**: Django 5, Django REST Framework, python-dotenv, Whitenoise, Gunicorn  
- **Database**: SQLite (dev) / PostgreSQL (prod-ready via `psycopg` + `dj-database-url`)  
- **External APIs**: Geoapify (geocoding, routing, reverse geocoding)  
- **Storage**: AWS S3 via `django-storages` + `boto3` (for static/media in production)  
- **DevOps**: Docker / Docker Compose, GitHub Actions

---

## Notable Endpoints

- `POST /api/plan-route/` â€” main planning endpoint: geocodes start/finish, fetches route, runs fuel optimizer, returns stops + trip summary + route geometry  
- `POST /api/route-through-stops/` â€” lightweight endpoint that returns the Geoapify multi-waypoint route geometry through a given list of coordinates (used by the frontend for the detour polyline)  
- `GET /api/health/` â€” dataset health check

---

## Algorithm Highlights

- **Bounding-box pre-filter**: only stations inside the route's bounding box (+ margin) are loaded from the DB, avoiding full-table scans.  
- **Polyline downsampling**: the route polyline is downsampled to â‰¤ 400 vertices before station projection to keep the O(stations Ã— vertices) cost manageable.  
- **Bisect-based range lookup**: candidate stations are sorted by mile-marker; `bisect` is used for O(log N) range queries in the planning loop.  
- **Minimum purchase threshold**: configurable `MIN_GALLONS_PER_STOP` prevents tiny top-up stops; the planner delays stopping until a meaningful fill-up is needed.  
- **Trip cost allocation**: if more fuel is purchased than burned (leftover in tank), only the consumed share of the purchase cost is attributed to the current trip.

<div data-lang="en" style="margin-top: 2rem; padding: 0.75rem 1rem; border: 1px solid #e2e8f0; border-radius: 0.5rem; background: #f8fafc; text-align: center; font-size: 0.8rem; color: #64748b;">
  ðŸ‡§ðŸ‡· Esta pÃ¡gina tambÃ©m estÃ¡ disponÃ­vel em <a href="/pt/projects/app3" style="color: #3b82f6; text-decoration: underline;">PortuguÃªs</a>
</div>

</div>

{/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ðŸ‡§ðŸ‡·  PORTUGUÃŠS
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}

<div data-lang="pt">

## VisÃ£o Geral

Ferramenta completa de planejamento de rotas para caminhoneiros nos EUA. Dado um ponto de partida e um destino, o sistema geocodifica ambos os locais, busca a rota de direÃ§Ã£o via API Geoapify Routing e executa um otimizador de paradas de abastecimento que seleciona os postos de diesel mais baratos ao longo do corredor da rota â€” respeitando a autonomia mÃ¡xima e o consumo (MPG) do caminhÃ£o â€” para minimizar o custo total de combustÃ­vel da viagem.

O frontend em React/TypeScript renderiza um mapa interativo com Leaflet que se atualiza progressivamente: a rota base Aâ†’B aparece primeiro, e depois a polilinha de desvio pelos postos escolhidos Ã© carregada em segundo plano sem bloquear a interface.

---

## Principais Funcionalidades

- **Planejamento Otimizado de Paradas**  
  Planejador greedy que seleciona os postos de diesel mais baratos e acessÃ­veis ao longo do corredor da rota (dentro de ~5 milhas da polilinha), garantindo sempre que o caminhÃ£o consiga chegar Ã  prÃ³xima parada ou ao destino sem ficar sem combustÃ­vel.

- **Dados Reais de PreÃ§o de Diesel**  
  Os preÃ§os de combustÃ­vel sÃ£o carregados a partir de um dataset CSV real de postos de diesel nos EUA, importado para um banco PostgreSQL/SQLite com Ã­ndices espaciais para consultas rÃ¡pidas por bounding box.

- **ParÃ¢metros ConfigurÃ¡veis do CaminhÃ£o**  
  Suporta MPG e autonomia mÃ¡xima (milhas) personalizados. A opÃ§Ã£o "iniciar com tanque vazio" aciona uma parada prÃ©-viagem prÃ³xima Ã  origem antes de entrar na rodovia.

- **Mapa Interativo (Leaflet)**  
  Exibe a rota base, a polilinha de desvio pelos postos de abastecimento e marcadores personalizados para origem, destino e cada posto (com popup de detalhes: nome, endereÃ§o, preÃ§o, litros comprados, custo).

- **Autocomplete de Cidades**  
  Input com autocomplete e debounce alimentado pela API Geoapify Places para busca rÃ¡pida de cidades e estados.

- **Carregamento Progressivo**  
  A rota base e a lista de paradas sÃ£o exibidas imediatamente apÃ³s a primeira resposta da API; a polilinha de desvio por todos os postos Ã© buscada de forma assÃ­ncrona e atualiza o mapa sem re-renderizar toda a interface.

- **Painel de Resumo da Viagem**  
  A barra lateral exibe a distÃ¢ncia total (incluindo desvios), duraÃ§Ã£o estimada, nÃºmero de paradas e custo total estimado de combustÃ­vel.

- **CÃ¡lculo de Desvio**  
  O backend calcula as milhas extras adicionadas pelo desvio de cada posto usando projeÃ§Ã£o de polilinha e agrega o total de milhas de desvio no resumo da viagem.

- **Endpoint de Health Check**  
  `/api/health/` verifica se o dataset de preÃ§os estÃ¡ carregado e retorna a contagem de postos, usado pelo frontend para confirmar a conectividade com a API.

- **Suporte a Docker**  
  Ambos os serviÃ§os incluem Dockerfiles e um `docker-compose.yml` para setup local com um Ãºnico comando.

---

## Stack TecnolÃ³gica

- **Frontend**: React 18, TypeScript, Vite, React-Leaflet, TailwindCSS  
- **Backend**: Django 5, Django REST Framework, python-dotenv, Whitenoise, Gunicorn  
- **Banco de Dados**: SQLite (dev) / PostgreSQL (pronto para produÃ§Ã£o via `psycopg` + `dj-database-url`)  
- **APIs Externas**: Geoapify (geocodificaÃ§Ã£o, roteamento, geocodificaÃ§Ã£o reversa)  
- **Armazenamento**: AWS S3 via `django-storages` + `boto3` (para estÃ¡ticos/mÃ­dia em produÃ§Ã£o)  
- **DevOps**: Docker / Docker Compose, GitHub Actions

---

## Endpoints Principais

- `POST /api/plan-route/` â€” endpoint principal: geocodifica origem/destino, busca rota, executa o otimizador de combustÃ­vel e retorna paradas + resumo da viagem + geometria da rota  
- `POST /api/route-through-stops/` â€” endpoint leve que retorna a geometria da rota Geoapify com mÃºltiplos waypoints (usado pelo frontend para a polilinha de desvio)  
- `GET /api/health/` â€” verificaÃ§Ã£o de saÃºde do dataset

---

## Destaques do Algoritmo

- **PrÃ©-filtro por bounding box**: apenas os postos dentro do bounding box da rota (+ margem) sÃ£o carregados do banco, evitando varreduras completas na tabela.  
- **Downsampling da polilinha**: a polilinha da rota Ã© reduzida para â‰¤ 400 vÃ©rtices antes da projeÃ§Ã£o dos postos, mantendo o custo O(postos Ã— vÃ©rtices) gerenciÃ¡vel.  
- **Busca por intervalo com bisect**: os postos candidatos sÃ£o ordenados por marco de milha; `bisect` Ã© usado para consultas de intervalo em O(log N) no loop de planejamento.  
- **Limite mÃ­nimo de compra**: o `MIN_GALLONS_PER_STOP` configurÃ¡vel evita paradas de abastecimento mÃ­nimo; o planejador adia a parada atÃ© que um reabastecimento significativo seja necessÃ¡rio.  
- **AlocaÃ§Ã£o de custo da viagem**: se mais combustÃ­vel for comprado do que consumido (sobra no tanque), apenas a parcela consumida do custo de compra Ã© atribuÃ­da Ã  viagem atual.

<div data-lang="pt" style="margin-top: 2rem; padding: 0.75rem 1rem; border: 1px solid #e2e8f0; border-radius: 0.5rem; background: #f8fafc; text-align: center; font-size: 0.8rem; color: #64748b;">
  ðŸ‡ºðŸ‡¸ This page is also available in <a href="/projects/app3" style="color: #3b82f6; text-decoration: underline;">English</a>
</div>

</div>
